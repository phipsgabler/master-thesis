\documentclass[11pt,a4paper,twoside,draft]{memoir}
\usepackage[final,protrusion,babel]{microtype}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage[style=english]{csquotes}
\usepackage{xspace}
\usepackage[final]{graphicx}
\usepackage[textsize=tiny]{todonotes}
\usepackage[final,hyperfootnotes=false]{hyperref}

% \usepackage{placeins}           % \FloatBarrier
%\usepackage{float}             % H float placement
\usepackage[originalcommands]{ragged2e} % improved ragged paragraphs in abstract
\usepackage{eso-pic}

\usepackage{amsmath}
\usepackage{amssymb}
%\usepackage{pifont}
% \usepackage{fourier-orns}

\usepackage{typographic_setup}
\usepackage[final]{mylistings}
\usepackage{jlcode}

\hypersetup{
  pdfinfo={
    Author={Philipp Gabler},
    Title={Automatic Graph Tracking in Probabilistic Models via Source Transformations}
  },
  % colorlinks=false
}

%-------------------------------------------------------------------------------
% BIBLATEX
%

\usepackage[%
  backend=biber,
  citestyle=alphabetic,
  style=alphabetic,
  sortcites=true,
  sorting=nyt,
  %natbib=true,
  firstinits=true,
  %url=false,
  isbn=false,
  date=iso8601,
  urldate=iso8601
]{biblatex}
\DeclareNameAlias{default}{last-first}

% only capitalize real titles
% http://tex.stackexchange.com/a/22981/46356
\DeclareFieldFormat{sentencecase}{\MakeSentenceCase{#1}}
\renewbibmacro*{title}{%
  \ifthenelse{\iffieldundef{title}\AND\iffieldundef{subtitle}}
    {}
    {\printtext[title]{%
        \printfield[sentencecase]{title}%
        \setunit{\subtitlepunct}%
        \printfield[sentencecase]{subtitle}}
      \newunit}%
  \printfield{titleaddon}}

\defbibheading{memoir}[\bibname]{\chapter*{#1}}
\setcounter{biburllcpenalty}{7000}
\setcounter{biburlucpenalty}{8000}

\AtEveryBibitem{\clearlist{language}} % clears language
\renewcommand*\bibnamedash{\rule[0.48ex]{3em}{0.14ex}\space}
\renewcommand*{\multinamedelim}{;\space}
\renewcommand*{\finalnamedelim}{;\space}

\addbibresource{refs.bib}

\usepackage{breakurl}
%\hypersetup{breaklinks=false}

%-------------------------------------------------------------------------------
% OTHER SETTINGS
%

\AtBeginDocument{%
  \lstMakeShortInline[style={inline}]|
}

% toc
% \setlength{\cftbeforechapterskip}{1ex} % decrease space between sections

% floats and epigraphs
\newlength{\capwidth}
\addtolength{\capwidth}{\textwidth}
\addtolength{\capwidth}{-4ex}
\captionwidth{\capwidth}
\captionstyle[\raggedright]{}

\setlength{\epigraphwidth}{\textwidth}
\setlength{\epigraphrule}{0pt}

\renewcommand{\textfloatsep}{\baselineskip}

\setcounter{topnumber}{1}       % allow only one float per page

% no need for colors here...
% \colorlet{textred}{darkgray!80}
% \colorlet{textblue}{darkgray!80}

\newcommand{\lstlistingautorefname}{Listing}

% csquotes
% redefine spacing above/below; hacking original latex definition from 
% http://mirrors.ctan.org/macros/latex/base/classes.dtx
\makeatletter
\newenvironment{myblockquote}
               {\vspace{-1em}\list{}{\listparindent 1.5em%
                        \itemindent    \listparindent
                        \rightmargin   \leftmargin
                        \parsep        \z@ \@plus\p@}%
                \item\relax}
               {\endlist\vspace{-0.5\baselineskip}}
\makeatother
\SetBlockEnvironment{myblockquote}


% TIKZ SETUP
% \usepackage{tikz}
% \usepackage{rotating}

%-------------------------------------------------------------------------------
% DOCUMENT MACROS
%
\newcommand{\ie}{i.e.\xspace}
\newcommand{\eg}{e.g.\xspace}
\newcommand{\cf}{cf.\xspace}
\newcommand{\margintodo}[1]{\todo[noline, size=\tiny]{#1}}
% \newcommand{\CC}{{C\nolinebreak[4]\hspace{-.05em}\raisebox{.22ex}{\small\textbf{++}}}}
% \newcommand{\autosubref}[1]{{\hyperref[#1]{Subsection~\ref*{#1}~--~\nameref*{#1}}}}
% \newcommand{\autosubref}[1]{\autoref{#1}}
% \newcommand{\aref}[1]{\hyperref[#1]{Appendix~\ref{#1}}}
\newcommand{\mathlst}[1]{\text{\lstinline|1|}}


%-------------------------------------------------------------------------------
% DOCUMENT
%-------------------------------------------------------------------------------
\begin{document}
\chapterstyle{hangnum}
\frontmatter

\setcounter{page}{1} % titlingpage resets to 1 afterwards
\input{title}
\setcounter{page}{3}

\cleartorecto
\input{declaration}

\cleartorecto
\input{license}


%-------------------------------------------------------------------------------
% ABSTRACT
\cleartorecto
\input{abstract}


%-------------------------------------------------------------------------------
% TOC
\cleartorecto
\begingroup
\hypersetup{linkcolor=black, hyperindex=true}
\label{toc}
\currentpdfbookmark{Contents}{toc}
\tableofcontents*
\endgroup


% -------------------------------------------------------------------------------
% CHAPTERS
\mainmatter

\include{introduction}
\include{background}
\include{automatic_graph_tracking}
\include{discussion}


% -------------------------------------------------------------------------------
% BIBLIOGRAPHY
\cleartorecto
\begingroup
\microtypesetup{protrusion=false, expansion=false}
%\raggedright
\phantomsection
\addcontentsline{toc}{chapter}{Bibliography}
\printbibliography[heading=memoir]
\endgroup


% -------------------------------------------------------------------------------
% APPENDIX
% \cleartorecto
% \backmatter
% \appendix
% \appendixpage*

% \chapter{Example Programs}
% \label{sec:appendix}


% -------------------------------------------------------------------------------
% COLOPHON
\cleartoverso
\input{colophon}

\end{document}

%%% Local Variables: 
%%% TeX-master: "main"
%%% mode: latex
%%% TeX-command-extra-options: "-shell-escape"
%%% End:
